(function(m,i){var g,h,n=/^\/+|\/+$/g,j=function(a){return(a||"").replace(n,"")},o=/\/+$/g,p=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,k=typeof String.trim==="function"?String.trim:function(a){return(a||"").replace(p,"")},l=function(a,c){var b;for(b in c)if(c.hasOwnProperty(b)&&typeof c[b]!=="function")a[b]=c[b]};g=function(a,c){this.uri=new h(a);this.settings=c;if(!this.settings.dataType&&this.settings.dataType==="jsonp"){this.uri.segments.options=this.uri.segments.options||{};this.uri.segments.options.format=
"json";this.uri.segments.options.callback="resultCallback"}};g.prototype.from=function(a){var c=new g(this.uri.segments,this.settings);c.uri.segments.resource=a;return c};g.prototype.query=function(a){if(a&&typeof a==="function")a={success:a};this.ajax(a)};g.prototype.create=function(a,c,b){var d=new g(this.uri.segments,this.settings);d.uri.segments.resource=a;if(b&&typeof b==="function")b={success:b};b.type="POST";b.data=JSON.stringify(c);d.ajax(b)};g.prototype.update=function(a,c,b){var d=new g(this.uri.segments,
this.settings),e={partial:true,force:false,etag:null};d.uri.segments.resource=a;if(b&&typeof b==="function")e={success:b};else l(e,b);if(!b.etag&&!c.__metadata&&!c.__metadata.etag)e.etag=c.__metadata.etag;e.type=e.partial?"MERGE":"PUT";if(typeof c==="object"){e.data=JSON.stringify(c);e.contentType="application/json"}else{e.data=c.toString();e.contentType="text/plain"}d.ajax(e)};g.prototype.remove=function(a,c){var b=new g(this.uri.segments,this.settings),d={force:false,etag:null};if(c&&typeof c===
"function")d={success:c};else l(d,c);if(!c.etag&&!a.__metadata&&!a.__metadata.etag)d.etag=a.__metadata.etag;if(d.force)d.etag="*";d.type="DELETE";b.uri=!a.__metadata&&!a.__metadata.uri?this.uri.parse(a.__metadata.uri):b.uri=that.uri.parse(a);b.ajax(d)};h=function(a){this.segments=a;if(typeof a==="string"){this.segments={};this.segments.root=a}if(!this.segments.root)throw{name:"missing argument",message:"root is not specified"};};h.prototype.parse=function(a){var c,b,d,e,f=this.segments.root;c=new h(f);
a=a.split("?");if(a.length>2)throw{name:"invalid input",message:"uri is not valid, to many ? in the uri"};d=a[1];b=a[0].toUpperCase();f=f.toUpperCase();if(b.indexOf(f)===0)b=a[0].slice(f.length);else if((e=b.indexOf(f))>0)b=a[0].slice(f.length+e);else{e=0;do{f=f.slice(1);e+=1}while(f.length>0&&b.indexOf(f)!==0);b=a[0].slice(f.length)}a=b.split("/$value");if(a.length===2)c.segments.value=true;b=a[0];a=b.split("/$count");if(a.length===2)c.segments.count=true;b=a[0];if(!c.segments.value&&(a=b.split("/$links/")).length===
2){c.segments.resource=j(k(a[0]));c.segments.links=a[1]}else c.segments.resource=j(k(b));if(d!==i&&d.length>0){a=d.split("&");if(f=a.length)c.segments.options={};d=c.segments.options;for(e=0;e<f;e+=1){b=a[e].split("=");switch(b[0]){case "$orderby":d.orderby=b[1];break;case "$top":d.top=parseInt(b[1],10);break;case "$skip":d.skip=parseInt(b[1],10);break;case "$filter":d.filter=b[1];break;case "$expand":d.expand=b[1];break;case "$select":d.select=b[1];break;case "$skiptoken":d.skiptoken=b[1];break;
case "$inlinecount":d.inlinecount=b[1]==="allpages";break;case "$format":d.format=b[1];break;default:if(!d.params)d.params={};d.params[b[0]]=b[1];break}}}return c};h.prototype.stringify=function(){var a,c,b,d=false,e,f="";c=this.segments;a=c.options;if(!c.root)return"";e=c.resource||"";if(c.links)e+="/$links/"+j(c.links);if(c.count)e+="/$count";else if(c.value)e+="/$value";for(b in a)if(b!==i&&a[b]!==null)switch(b){case "params":for(b in a.params)if(b!==i){if(d)f+="&";f+=b+"="+a.params[b];d=true}break;
case "inlinecount":if(a.inlinecount){if(d)f+="&";f+="$inlinecount=allpages";d=true;break}break;case "format":if(a[b]==="json"&&(c.count||c.value))break;case "callback":case "orderby":case "top":case "skip":case "filter":case "expand":case "select":case "skiptoken":if(d)f+="&";f+="$"+b+"="+a[b];d=true;break}this.uri=(k(c.root)||"").replace(o,"");this.uri+=e!==""?"/"+e:"";this.uri+=f!==""?"?"+f:"";return this.uri};m.oData=function(a,c){return new g(a,c)}})(window);
