(function(l){var h,m=/^\/+|\/+$/g,i=function(a){return(a||"").replace(m,"")},n=/\/+$/g,o=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,k=typeof String.trim==="function"?String.trim:function(a){return(a||"").replace(o,"")},j=function(a,c){var b;for(b in c)if(c.hasOwnProperty(b)&&typeof c[b]!=="function")a[b]=c[b];return a},f=function(a,c){this.uri=a instanceof h?a:new h(a);if((this.settings=c)&&this.settings.dataType&&this.settings.dataType==="jsonp"){this.uri.segments.options=this.uri.segments.options||{};this.uri.segments.options.format=
"json";this.uri.segments.options.callback="resultCallback"}};f.prototype.clone=function(){var a=this.uri.clone();a=new f(a);a.settings=this.settings?j({},this.settings):undefined;return a};f.prototype.query=function(a){if(a&&typeof a==="function")a={success:a};this.ajax(a)};f.prototype.create=function(a,c,b){this.uri.segments.resource=a;if(b&&typeof b==="function")b={success:b};b.type="POST";b.data=JSON.stringify(c);this.ajax(b)};f.prototype.update=function(a,c,b){var d={partial:true,force:false,
etag:null};this.uri.segments.resource=a;if(b&&typeof b==="function")d={success:b};else j(d,b);if(!b.etag&&!c.__metadata&&!c.__metadata.etag)d.etag=c.__metadata.etag;d.type=d.partial?"MERGE":"PUT";if(typeof c==="object"){d.data=JSON.stringify(c);d.contentType="application/json"}else{d.data=c.toString();d.contentType="text/plain"}this.ajax(d)};f.prototype.remove=function(a,c){var b={force:false,etag:null};if(c&&typeof c==="function")b={success:c};else j(b,c);if(!c.etag&&!a.__metadata&&!a.__metadata.etag)b.etag=
a.__metadata.etag;if(b.force)b.etag="*";b.type="DELETE";this.uri=!a.__metadata&&!a.__metadata.uri?this.uri.parse(a.__metadata.uri):this.uri=this.uri.parse(a);this.ajax(b)};f.prototype.from=function(a){this.uri.segments.resource=i(a);return this};f.prototype.links=function(a){this.uri.segments.links=a;return this};f.prototype.orderby=function(a){this.uri.segments.options=this.uri.segments.options||{};this.uri.segments.options.orderby=a;return this};f.prototype.top=function(a){this.uri.segments.options=
this.uri.segments.options||{};this.uri.segments.options.top=a;return this};f.prototype.skip=function(a){this.uri.segments.options=this.uri.segments.options||{};this.uri.segments.options.skip=a;return this};f.prototype.filter=function(a){this.uri.segments.options=this.uri.segments.options||{};this.uri.segments.options.filter=a;return this};f.prototype.expand=function(a){this.uri.segments.options=this.uri.segments.options||{};this.uri.segments.options.expand=i(a);return this};f.prototype.select=function(a){if(a===
"*")return this;this.uri.segments.options=this.uri.segments.options||{};this.uri.segments.options.select=a;return this};f.prototype.inlinecount=function(a){if(a===false||a==="none")return this;this.uri.segments.options=this.uri.segments.options||{};this.uri.segments.options.inlinecount=true;return this};f.prototype.params=function(a){this.uri.segments.options=this.uri.segments.options||{};this.uri.segments.options.params=a;return this};f.prototype.count=function(a){var c=true,b=a;if(typeof a==="boolean")c=
a;else if(typeof b==="function")b={success:a};else if(a===undefined)c=false;this.uri.segments.count=true;if(c)this.ajax(b);else return this};f.prototype.value=function(a){var c=true,b=a;if(typeof a==="boolean")c=a;else if(typeof b==="function")b={success:a};else if(a===undefined)c=false;this.uri.segments.value=true;if(c)this.ajax(b);else return this};h=function(a){this.segments=a;if(typeof a==="string"){this.segments={};this.segments.root=a}if(this.segments.resource&&typeof this.segments.resource===
"string")this.segments.resource=i(this.segments.resource);if(this.segments.options&&this.segments.options.expand&&typeof this.segments.options.expand==="string")this.segments.options.expand=i(this.segments.options.expand);if(!this.segments.root)throw{name:"missing argument",message:"root is not specified"};};h.prototype.clone=function(){var a=j({},this.segments);return new h(a)};h.prototype.parse=function(a){var c,b,d,g,e=this.segments.root;c=new h(e);a=a.split("?");if(a.length>2)throw{name:"invalid input",
message:"uri is not valid, to many ? in the uri"};d=a[1];b=a[0].toUpperCase();e=e.toUpperCase();if(b.indexOf(e)===0)b=a[0].slice(e.length);else if((g=b.indexOf(e))>0)b=a[0].slice(e.length+g);else{g=0;do{e=e.slice(1);g+=1}while(e.length>0&&b.indexOf(e)!==0);b=a[0].slice(e.length)}a=b.split("/$value");if(a.length===2)c.segments.value=true;b=a[0];a=b.split("/$count");if(a.length===2)c.segments.count=true;b=a[0];if(!c.segments.value&&(a=b.split("/$links/")).length===2){c.segments.resource=i(k(a[0]));
c.segments.links=a[1]}else c.segments.resource=i(k(b));if(d!==undefined&&d.length>0){a=d.split("&");if(e=a.length)c.segments.options={};d=c.segments.options;for(g=0;g<e;g+=1){b=a[g].split("=");switch(b[0]){case "$orderby":d.orderby=b[1];break;case "$top":d.top=parseInt(b[1],10);break;case "$skip":d.skip=parseInt(b[1],10);break;case "$filter":d.filter=b[1];break;case "$expand":d.expand=b[1];break;case "$select":d.select=b[1];break;case "$skiptoken":d.skiptoken=b[1];break;case "$inlinecount":d.inlinecount=
b[1]==="allpages";break;case "$format":d.format=b[1];break;default:if(!d.params)d.params={};d.params[b[0]]=b[1];break}}}return c};h.prototype.stringify=function(){var a,c,b,d=false,g,e="";c=this.segments;a=c.options;if(!c.root)return"";g=c.resource||"";if(c.links)g+="/$links/"+i(c.links);if(c.count)g+="/$count";else if(c.value)g+="/$value";for(b in a)if(b!==undefined&&a[b]!==null)switch(b){case "params":for(b in a.params)if(b!==undefined){if(d)e+="&";e+=b+"="+a.params[b];d=true}break;case "inlinecount":if(a.inlinecount){if(d)e+=
"&";e+="$inlinecount=allpages";d=true;break}break;case "format":if(a[b]==="json"&&(c.count||c.value))break;case "callback":case "orderby":case "top":case "skip":case "filter":case "expand":case "select":case "skiptoken":if(d)e+="&";e+="$"+b+"="+a[b];d=true;break}this.uri=(k(c.root)||"").replace(n,"");this.uri+=g!==""?"/"+g:"";this.uri+=e!==""?"?"+e:"";return this.uri};l.oData=function(a,c){return new f(a,c)}})(window);
